import{b as x,f as r,a as I,t as T}from"./index.dacc6b91.js";import{_ as S,E as f,r as u,o as p,c as b,a as s,w as e,p as B,b as F,d,t as i,e as E,f as n,g as H}from"./index.2c59d660.js";const C=[[1520,6.25],[760,12.5],[506,18.75],[380,25],[304,31.25],[253,37.5],[217,43.7],[190,50],[168,56.25],[152,62.26],[138,68.75],[126,75],[116,81.25],[108,87.5],[101,93.75]],N=["\u6241\u5934\u54C8\u90A3\u9CA8","\u5927\u767D\u9CA8","\u7070\u9CAD\u9CA8","\u725B\u5934\u9CA8","\u89D2\u9CA8","\u864E\u9CA8","\u53CC\u9AFB\u9CA8","\u9ED1\u9CCD\u7901\u9CA8","\u661F\u9CA8","\u82B1\u6591\u9CA8","\u6A21\u62C9\u91CC\u4E4C\u9CA8","\u952F\u9CA8","\u65E5\u672C\u6241\u9CA8","\u76B1\u9CC3\u9CA8","\u952F\u5C3E\u9CA8","\u5C16\u5C3E\u9CA8"],W={data(){return{provider:null,dialogVisible:!1,contracts:{coin:"",defi:""},game:{min:1,max:1e3,rate:1,lucky:10,decimals:8,species:"",hash:"",code:""},refer:"0x906921df1608bCFc3b9a1D99667682fAA44f3a47",wallet:{address:"",approved:0},user:{},form:{amount:0,boxes:1,to:"",rank:0,luckyPercent:40},lottery:{},site:{burnTokens:0,machinePowerPercent:1}}},watch:{"wallet.address"(){this.contracts.coin=x(this.provider.eth.Contract,"coin"),this.contracts.defi=x(this.provider.eth.Contract,"defi"),this.updateInfo()}},mounted(){let t=50,l=this;setTimeout(function k(){if(!window.ethereum)return--t>0?setTimeout(k,100):null;window.ethereum?(l.provider=new Web3(window.ethereum),console.log("ethereum",window.ethereum)):window.web3?(l.provider=window.web3.currentProvider,console.log("provider",window.web3.currentProvider)):(l.provider=new Web3.providers.HttpProvider("http://localhost:7545"),console.log("ganache",l.provider)),ethereum.request({method:"eth_requestAccounts"}).then(w=>{console.log(w);let o=l.$route.query.a;o&&o.length==42&&(console.log("set refer to: ",o),l.refer=o),l.wallet.address=w[0]})},100)},methods:{updateInfo(){this.contracts.coin.methods.balanceOf(this.wallet.address).call().then(t=>{console.log(t),this.wallet.balance=r(this.provider.utils,t)}),this.contracts.coin.methods.allowance(this.wallet.address,I.defi).call().then(t=>{console.log("approved:",t),this.wallet.approved=t>this.game.min}),this.contracts.defi.methods.user(this.wallet.address).call().then(t=>{console.log(t),this.lottery={amount:t.last.amount,flag:t.last.flag,rate:t.last.rate},this.user={refer:t.refer,members:t.members,rank:t.rank,shares:t.shares,times:t.times,won:t.won,withdrawTime:t.withdrawTime},this.user.cost=r(this.provider.utils,t.cost),this.user.balance=r(this.provider.utils,t.balance),this.user.business=r(this.provider.utils,t.business),this.user.machines=r(this.provider.utils,t.machines),this.user.capacity=r(this.provider.utils,t.capacity),this.user.shareTokens=r(this.provider.utils,t.shareTokens),this.user.rankTokens=r(this.provider.utils,t.rankTokens),this.user.mineTokens=r(this.provider.utils,t.mineTokens),this.user.lotteryTokens=r(this.provider.utils,t.lotteryTokens),this.user.withdraw=r(this.provider.utils,t.withdraw),this.lottery.amount=r(this.provider.utils,this.lottery.amount),t.machines>0&&(this.user.machinesPower=parseFloat((new Date().getTime()/1e3-t.withdrawTime)/86400*this.user.machines*this.site.machinePowerPercent/1e3).toFixed(4),this.user.balance+=this.user.machinesPower)}).catch(t=>{console.error("defi user ",t)})},bet(){if(this.form.amount>this.wallet.balance){console.log(this.form.amount>this.wallet.balance),f({showClose:!0,message:"\u94B1\u5305\u4F59\u989D\u4E0D\u8DB3",type:"error"});return}if(this.form.amount<this.game.min){console.log(this.form.amount<this.game.min),f({showClose:!0,message:"\u6295\u6CE8\u91D1\u989D\u4E0D\u5C11\u4E8E"+this.game.min,type:"error"});return}if(this.form.amount>this.game.max){console.log(this.form.amount>this.game.max),f({showClose:!0,message:"\u6295\u6CE8\u91D1\u989D\u4E0D\u8D85\u8FC7"+this.game.max,type:"error"});return}this.contracts.defi.methods.bet(this.refer,T(this.provider.utils,this.form.amount),this.form.boxes).send({from:this.wallet.address,gasLimit:35e5}).then(t=>{console.log(t),this.game.hash=t.blockHash,this.game.code=t.blockHash[t.blockHash.length-1],this.game.species=N[parseInt(this.game.code,16)],this.updateInfo(),this.dialogVisible=!0}).catch(t=>{console.error(t)})},showSite(){this.contracts.defi.methods.info().call().then(t=>{console.log("site info :",t),this.site.machinePowerPercent=t[0],this.site.burnTokens=r(this.provider.utils,t[2])})},approve(){this.contracts.coin.methods.approve(this.address.defi,T(this.provider.utils,"990000000000000000000")).send({from:this.wallet.address}).then(t=>{console.log("approve :",t),this.updateInfo()})},withdraw(){this.contracts.defi.methods.withdraw().send({from:this.wallet.address}).then(t=>{console.log("withdrawn ",t),this.updateInfo()})},setBox(t){this.form.boxes=this.form.boxes%16,this.game.rate=C[this.form.boxes-1][0]/100,this.game.lucky=C[this.form.boxes-1][1]},copyShareLink(){this.$copyText(`${window.location.origin}/#/?a=${this.wallet.address}`).then(function(t){f({showClose:!0,message:"\u62F7\u8D1D\u6210\u529F",type:"success"}),console.log(t)},function(t){alert("Can not copy"),console.log(t)})}}},v=t=>(B("data-v-f60cb7a8"),t=t(),F(),t),q={class:"container"},A={class:"card-header"},D=n("\u6388\u6743"),L={key:1,class:"small"},U=n("\u5168\u7F51\u71C3\u70E7 "),j=n("\u6D41\u6C34 "),M=n("\u77FF\u673A\u4EA7\u91CF"),O=n("\u77FF\u5C71\u5BB9\u91CF"),z=n("\u5206\u4EAB\u6536\u76CA"),G=n("\u7D2F\u8BA1\u7B97\u529B\u6536\u76CA"),J=n("\u7B97\u529B\u6536\u76CA "),K=n("\u672C\u6B21\u4E2D\u5956"),Q=n("\u7D2F\u8BA1\u4E2D\u5956\u6570\u989D"),R=n("\u5DF2\u63D0\u6536\u76CA"),X=n("\u53EF\u63D0\u6536\u76CA "),Y=n(" \u63D0\u73B0 "),Z={class:"card-header"},$=v(()=>d("span",null,"\u7EC4\u7EC7 ",-1)),ee=n("\u9080\u8BF7\u94FE\u63A5 "),se=n("\u63A8\u8350\u4EBA"),te=n("\u7B49\u7EA7 "),oe=n("\u76F4\u63A8\u4F1A\u5458"),ne=n("\u56E2\u961F\u4F1A\u5458"),ae=n("\u56E2\u961F\u6536\u76CA"),ie=n("\u7D2F\u8BA1\u56E2\u961F\u6536\u76CA "),le=n("\u56E2\u961F\u4E1A\u7EE9\u4F1A\u5458"),re={class:"card-header"},de=v(()=>d("span",null,"\u76F2\u76D2\u6E38\u620F",-1)),ce=n("\u6295\u6CE8"),ue=n(" \u6295\u6CE8\u91D1\u989D"),he=n(" \u8D2D\u4E70\u4E2A\u6570"),_e={key:0,class:"col"},me={class:""},fe={class:""},pe={class:""},we=v(()=>d("a",{href:"#set"},"SET",-1));function ge(t,l,k,w,o,h){const m=u("el-button"),a=u("el-col"),c=u("el-row"),g=u("el-card"),V=u("el-space"),y=u("el-input-number"),P=u("el-dialog");return p(),b("div",q,[s(c,null,{default:e(()=>[s(a,{span:8,offset:2},{default:e(()=>[s(V,{direction:"vertical"},{default:e(()=>[s(g,{class:"box-card"},{header:e(()=>[d("div",A,[d("span",null,"\u94B1\u5305\u4F59\u989D "+i(o.wallet.balance),1),o.wallet.approved?(p(),b("span",L,"\u5DF2\u6388\u6743")):(p(),E(m,{key:0,type:"success",round:"",onClick:h.approve},{default:e(()=>[D]),_:1},8,["onClick"]))])]),default:e(()=>[s(c,null,{default:e(()=>[s(a,{span:12},{default:e(()=>[U]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.site.burnTokens),1)]),_:1}),s(a,{span:12},{default:e(()=>[j]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.cost),1)]),_:1}),s(a,{span:12},{default:e(()=>[M]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.machines),1)]),_:1}),s(a,{span:12},{default:e(()=>[O]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.capacity),1)]),_:1}),s(a,{span:12},{default:e(()=>[z]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.shareTokens),1)]),_:1}),s(a,{span:12},{default:e(()=>[G]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.mineTokens),1)]),_:1}),s(a,{span:12},{default:e(()=>[J]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.machinesPower),1)]),_:1}),s(a,{span:12},{default:e(()=>[K]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.lottery&&o.lottery.flag?o.lottery.amount*o.lottery.rate:"-"),1)]),_:1}),s(a,{span:12},{default:e(()=>[Q]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.lotteryTokens),1)]),_:1}),s(a,{span:12},{default:e(()=>[R]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.withdraw),1)]),_:1}),s(a,{span:12},{default:e(()=>[X]),_:1}),s(a,{span:12},{default:e(()=>[n(i(parseFloat(o.user.balance).toFixed(2)),1)]),_:1}),s(a,{span:12},{default:e(()=>[s(m,{type:"warning",round:"",onClick:h.withdraw,disabled:o.user.balance<=1},{default:e(()=>[Y]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1}),s(g,{class:"box-card"},{header:e(()=>[d("div",Z,[$,s(m,{onClick:h.copyShareLink},{default:e(()=>[ee]),_:1},8,["onClick"])])]),default:e(()=>[s(c,null,{default:e(()=>[s(a,{span:12},{default:e(()=>[se]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.refer?o.user.refer.substr(0,8)=="0x000000"?"-":[o.user.refer.substr(0,4),"****",o.user.refer.substr(-5,5)].join(""):"-"),1)]),_:1}),s(a,{span:12},{default:e(()=>[te]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.rank),1)]),_:1}),s(a,{span:12},{default:e(()=>[oe]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.shares),1)]),_:1}),s(a,{span:12},{default:e(()=>[ne]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.groups),1)]),_:1}),s(a,{span:12},{default:e(()=>[ae]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.shareTokens),1)]),_:1}),s(a,{span:12},{default:e(()=>[ie]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.rankTokens),1)]),_:1}),s(a,{span:12},{default:e(()=>[le]),_:1}),s(a,{span:12},{default:e(()=>[n(i(o.user.business),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(a,{span:8,offset:2},{default:e(()=>[s(g,{class:"box-card"},{header:e(()=>[d("div",re,[de,s(m,{type:"primary",round:"",onClick:h.bet},{default:e(()=>[ce]),_:1},8,["onClick"])])]),default:e(()=>[s(c,{gutter:20},{default:e(()=>[s(a,null,{default:e(()=>[ue,s(y,{min:1,max:o.game.max,modelValue:o.form.amount,"onUpdate:modelValue":l[0]||(l[0]=_=>o.form.amount=_)},null,8,["max","modelValue"])]),_:1})]),_:1}),s(c,{gutter:20},{default:e(()=>[s(a,null,{default:e(()=>[he,s(y,{min:1,max:15,modelValue:o.form.boxes,"onUpdate:modelValue":l[1]||(l[1]=_=>o.form.boxes=_),onChange:h.setBox},null,8,["modelValue","onChange"])]),_:1})]),_:1}),s(c,{gutter:20},{default:e(()=>[s(a,null,{default:e(()=>[n("\u4E2D\u5956\u7387 "+i(o.game.lucky)+"% ",1)]),_:1})]),_:1}),s(c,{gutter:20},{default:e(()=>[s(a,null,{default:e(()=>[n("\u500D\u6570 "+i(o.game.rate),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(P,{modelValue:o.dialogVisible,"onUpdate:modelValue":l[2]||(l[2]=_=>o.dialogVisible=_),title:"\u5F00\u5956\u7ED3\u679C",width:"30%","before-close":t.handleClose},{default:e(()=>[s(c,{class:"column"},{default:e(()=>[o.game.code!=""?(p(),b("div",_e,[d("div",me,i(o.lottery.flag?"\u4E2D\u5956":"\u672A\u4E2D"),1),d("div",fe,"\u6D77\u6D0B\u52A8\u7269 "+i(o.game.species),1),d("div",pe,"\u54C8\u5E0C\u5C3E\u6570 "+i(o.game.code),1)])):H("",!0)]),_:1})]),_:1},8,["modelValue","before-close"]),we])}var ke=S(W,[["render",ge],["__scopeId","data-v-f60cb7a8"]]);export{ke as default};
